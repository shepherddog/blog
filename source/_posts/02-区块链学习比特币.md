---
title: 区块链学习(2):比特币白皮书读书笔记
date: 2018-04-23 12:44:39
tags: 区块链
comments: true
---
## 01 比特币是什么？

比特币是一种**去中心化的点对点技术实现的电子支付系统**，它使得在线支付能够直接由一方发起并支付给另外一方，中间不需要通过任何的金融机构。

白皮书的摘要说明了比特币的运行原理，如下:

> **摘要**：一个真正的的点对点的电子现金应该允许从发起方直接在线支付给对方，而不需要通过第三方的金融服务机构。现有的数字签名技术虽然提供了部分解决方案，但如果还需要经过一个可以信任的第三方机构来防止电子现金的“双重支付”，那就丧失了电子现金给人类带来的最大好处。我们针对电子现金会出现的“双重支付”问题，用点对点的网络技术提供了一个解决方案。该网络通过给交易记录打上时间戳，并通过哈希对其加密，然后将其并入一个不断增长的哈希记录所组成的链条文件中，以此形成一个新的交易记录，这个哈希记录链条文件（以下简称链条文件）是由一个需要证明工作量的系统网路所提供存储和计算服务的。没有基于工作量证明的系统网络来重新完成所有的工作量证明，一个已经形成的记录是不能被修改的。基于工作量证明的系统理念，最长的链条文件不仅仅是提供这些工作量序列事件记录的证据，而且它也是由最大的CPU处理能力池产生的。只要由计算机节点控制的大部分CPU处理能力不联合攻击网络本身，它们的处理能力将超过攻击者，并生成最大的链条文件。

中本聪抛出的问题，”**一个需要第三方支持的点对点电子现金系统是没有价值的**“，白皮书提供了一个解决方案，且说明了解决这个问题的主要方式和优势。
<!-- more -->
###   关键问题

如何**去中心化**：

> 去中心化依靠目前p2p技术已经有比较成熟的解决方案了，因此主要重点在于如何解决双花问题。

如何解决“**双花问题**”：

1.什么是双花问题？

> 如果同一笔钱（数字货币）被重复支付两次，就是双花问题（双重支付）。

2.传统方式如何解决？

> 传统货币黄金、白银无法复制，因此并不存在。纸币有通过防伪码,借助第三方机构进行监督，如果有人制造假币，会有法律进行惩罚。

3.比特币的解决方案

> 要解决“双花问题”则必须记账核对,那么如何在一个没有中心的p2p系统中记账又受到认同呢，比特币引入了基于时间戳的随机散列，并且让其形成前后文相关的序列。

> 借助不对称加密算法，通过公钥可以加密数据或验证数据，通过私钥可以解密数据或对数据签名，如此循环往复形成了一个**交易链条（即区块链）**通过公开公钥就可以知道这条记录的来路，直至最终到最初的所有者。

## 02 交易

### 流程定义

一枚电子货币是一串数字签名：

1. 每一位所有者通过对前一次交易和下一位拥有者的公钥签署一个随机散列的数字签名，并将这个签名附加在这枚电子货币的末尾；

2. 电子货币发送给下一位拥有者后， 收款人通过对签名进行校验，就能够验证该链条的所有者。

3. 该过程的问题在于，收款人将难以检验，之前的某位所有者，是否对这枚电子货币进行了双重支付。

4. 我们需要收款人有某种方法，能够确保之前的所有者没有对更早发生的交易实施签名。

5. 从逻辑上看，为了达到目的，实际上我们需要关注的只是于本交易之前发生的交易，而不需要关注这笔交易发生之后是否会有双重支付的尝试。为了确保某一次交易是不存在的，那么唯一的方法就是获悉之前发生过的所有交易。

6. 如果想要在电子系统中排除第三方中介机构，那么交易信息就应当被公开宣布（publicly announced)，我们需要整个系统内的所有参与者，都有唯一公认的历史交易序列。收款人需要确保在交易期间绝大多数的节点都认同该交易是首次出现.

![image](https://raw.githubusercontent.com/shepherddog/LearningNote/master/PIC/bitcoin_transactions.png)



### 上图是比特币的简化版本，有几个关键概念

公钥和私钥

> 公钥（public key)和私钥(private)是不对称加密算法中用于加密和解密的一对“钥匙”，因为使用了不同的“钥匙”加密和解密，因此叫做不对称加密算法。使用公钥对明文加密，密文只能使用私钥解密。

哈希（HASH)算法

> 哈希（HASH）指的一种计算机算法，将一段数据通过散列算法，变换为固定长度的输出。

数字签名

> 数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。（这里就是比特币）

## 03 时间戳服务器(Timestamp)

时间戳服务器是对区块形式的数据实施哈希中打上时间戳，并将哈希值广播全网。

该时间戳能够证实特定数据于某特定时间是确定存在的。 

每个时间戳都包括了前一个时间戳的哈希值,从而形成了链条。

如下图所示：

![image](https://raw.githubusercontent.com/shepherddog/LearningNote/master/PIC/bitcoin_timestamp.png)

### 疑问

比特币不是设计为“去中心化”，但是怎么又有中心化概念的时间戳服务器？

> 比特币基于工作量证明机制实现一个分布式的时间戳服务器。根据主链的节点的平均实际计算，合法的时间戳必须大于前11个区块时间的中位数，并且小于网络调整时间+2小时。。

## 04 工作量证明（POW)

比特币使用的工作量证明方法是对某一个随机数计算查找过程(**即挖矿**)，如SHA-256算法。简言之，就是通过计算机算力进行碰撞扫描，找到相应的随机数。扫描的难度会指数增长，但校验数据则只需要一次HASH。

工作量证明同时也解决了集体投票时谁是大多数的问题。因为最长的链代表了最大的工作量,大多数的决定表达为最长的链条。

工作量证明确保了不诚实的区块想要篡改诚实区块要付出更大的代价。

## 05 比特币网络传输步骤

比特币在网络上操作的步骤如下：

1. 新的交易被广播到所有节点。

2. 每个节点将交易记录到区块里。

3. 每个节点在区块中实现工作量证明。

4. 当节点完成工作量证明，它将区块广播给所有节点。

5. 节点只接受此类区块（区块内的所有交易都是有效的且区块尚未被消费）

6. 节点如何完成区块的接受：节点使用被接受的区块和节点HASH形成新的区块链，并把被接受的区块作为上一个节点。

所有的节点都把最长的链作为正确的区块链，并在这条链上扩展。

如果同时收到了两个区块，节点会同时储存两个区块链，确保能取得更长的那条区块链，当下一个工作量证明发现，节点会切换到更长的区块链上。

## 06 激励

矿工挖矿会得到激励，挖矿消耗的是算力（CPU时间+电力）。

比特币交易也会得到激励。

同时激励机制也鼓励节点保持诚实

## 07 磁盘空间回收

不含交易信息的区块头（Block header）大小仅有80字节。

### 默克尔树（Merkle Tree）

也是Hash Tree,存储hash值的一棵树,只需要验证根节点即可验证有效性。只需要存储根节点，节约了磁盘空间。

![image](https://raw.githubusercontent.com/shepherddog/LearningNote/master/PIC/Merkle_Tree.png)

这方面机制借鉴了P2P网络（如BT下载）

## 08 简化的支付确认 SPV

在不运行完整网络节点的情况下，也能够对支付进行检验。

## 09 价值可以组合和切分

为了使得价值易于组合与分割，交易被设计为可以纳入多个输入和输出。

## 10 隐私

传统银行模型隐私是任何通过可信第三方索取信息是严格受限的。

新的模型使用匿名的公钥。作为额外的预防措施，使用者可以让每次交易都生成一个新的地址，以确保这些交易不被追溯到一个共同的所有者。

![image](https://raw.githubusercontent.com/shepherddog/LearningNote/master/PIC/privacy.png)

## 11 计算方法

该章节通过数学公式计算，证明攻击者视图比诚实的链条更快的制造替代性区块链，即使如此，节点也不会接受无效的信息，一个攻击者能做的，最多是更改他自己的交易信息，并试图拿回他刚刚付给别人的钱。

## 12 结论

一种不需要信用中介的电子支付系统。

实现方案： 
    通用的电子货币的电子签名原理，为所有权提供了强有力的控制。 （缺憾：但是不足以防止双重支付）
    一种采用工作量证明机制的点对点网络来记录交易的公开信息。
